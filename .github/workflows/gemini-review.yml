name: "Gemini AI Dashboard"

on:
  push:
    branches-ignore:
      - 'ai-feedback'

jobs:
  update-review-dashboard:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Gemini Analysis
        uses: google-github-actions/run-gemini-cli@v0.1.14
        id: gemini
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          prompt: |
            Review the latest changes in the '${{ github.ref_name }}' branch.
            
            Create a comprehensive markdown report with:
            1. ðŸ” Summary of what changed
            2. ðŸ› Potential bugs or logic errors
            3. ðŸ›¡ï¸ Security analysis
            4. âœ¨ Refactoring suggestions

            Start the report with a clear header: "# Code Review for ${{ github.ref_name }}"
            
            Format everything as clean, readable Markdown.

      - name: Update Dashboard Branch
        run: |
          git config --global user.name "Gemini AI"
          git config --global user.email "gemini-bot@google.com"
          git checkout ai-feedback 2>/dev/null || git checkout --orphan ai-feedback
          git rm -rf . 2>/dev/null || true
          echo "${{ steps.gemini.outputs.response }}" > REVIEW.md
          echo -e "\n\n---\n*Generated at $(date)*" >> REVIEW.md
          git add REVIEW.md
          git commit -m "Update AI Review"
          git push -f origin ai-feedback
